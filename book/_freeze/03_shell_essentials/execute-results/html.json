{
  "hash": "cbb9977dfe02ea592b8a11acb06f4c26",
  "result": {
    "engine": "jupyter",
    "markdown": "# 03_shell_essentials.qmd\n\n---\ntitle: \"03 — Shell Essentials\"\nformat: html\nexecute:\n  echo: true\n---\n\nIntroduction — This file demonstrates a Python feature-building script and the shell commands used to run it and perform quick, lightweight inspections. Explanations below cover only the shell commands.\n\n::: {#5a5309cd .cell execution_count=1}\n``` {.python .cell-code}\nfrom pathlib import Path\nimport pandas as pd\nimport numpy as np\n\nPath(\"data/processed\").mkdir(parents=True, exist_ok=True)\ndf = pd.read_csv(\"data/raw/synth_prices.csv\", parse_dates=[\"date\"])\ndf = df.sort_values(\"date\").reset_index(drop=True)\ndf[\"log_return\"] = df[\"price\"].pct_change().apply(lambda x: np.log1p(x) if pd.notna(x) else 0.0)\ndf[\"sma_5\"] = df[\"price\"].rolling(5, min_periods=1).mean().round(6)\ndf[\"weekday\"] = df[\"date\"].dt.isocalendar().day.astype(\"int8\")\ndf.to_csv(\"data/processed/synth_features.csv\", index=False)\nprint(\"Wrote data/processed/synth_features.csv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWrote data/processed/synth_features.csv\n```\n:::\n:::\n\n\n```{bash}\nset -euo pipefail\npython3 scripts/build_features.py\n```\n\nThe `set -euo pipefail` line is a Bash safety idiom that makes scripts fail-fast and helps surface errors:\n- `-e` exits immediately if any command returns a non-zero status.\n- `-u` treats unset variables as an error and exits.\n- `-o pipefail` causes a pipeline to return a failure status if any command in the pipeline fails.\nTogether they reduce silent failures in shell scripts.\n\n`python3 scripts/build_features.py` runs the Python script using the `python3` interpreter found on `PATH`. When run under the `set -euo pipefail` settings, if the script exits with a non-zero status the shell will immediately stop execution.\n\n```{bash}\necho \"Rows in processed file:\"\nwc -l data/processed/synth_features.csv || true\necho \"First 5 lines:\"\nhead -n 6 data/processed/synth_features.csv || true\n```\n- `echo \"Rows in processed file:\"` prints a human-readable label to separate output sections.\n- `wc -l <file>` prints the number of lines in the file. This includes the header row if the CSV has one, so the result is typically `1 + number_of_data_rows`.\n- `head -n 6 <file>` prints the first 6 lines of the file. Using `-n 6` is a common pattern to show the header plus the first 5 data rows for quick verification.\n- The `|| true` appended to `wc` and `head` prevents the shell from exiting with a non-zero status when those commands fail (for example if the file does not exist). This is helpful when the surrounding script is run with `set -e`; it allows the inspection step to fail harmlessly while still showing any available output.\n\n",
    "supporting": [
      "03_shell_essentials_files\\figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}